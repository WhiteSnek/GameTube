FROM golang:latest

ARG PORT
ARG DB_HOST
ARG DB_PORT
ARG DB_USER
ARG DB_PASSWORD
ARG DB_NAME
ARG DB_SSLMODE
ARG ALLOWED_ORIGIN
ARG ACCESS_TOKEN_SECRET
ARG REFRESH_TOKEN_SECRET
ARG AWS_REGION
ARG AWS_ACCESS_KEY
ARG AWS_SECRET_KEY
ARG BUCKET_NAME
ARG VIDEO_BUCKET_NAME
ARG TASK_DEFINITION
ARG CLUSTER
ARG TRANSCODED_VIDEO_BUCKET_NAME


ENV PORT=${PORT}
ENV DB_HOST=${DB_HOST}
ENV DB_PORT=${DB_PORT}
ENV DB_USER=${DB_USER}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_NAME=${DB_NAME}
ENV DB_SSLMODE=${DB_SSLMODE}
ENV ALLOWED_ORIGIN=${ALLOWED_ORIGIN}
ENV ACCESS_TOKEN_SECRET=${ACCESS_TOKEN_SECRET}
ENV REFRESH_TOKEN_SECRET=${REFRESH_TOKEN_SECRET}
ENV AWS_REGION=${AWS_REGION}
ENV AWS_ACCESS_KEY=${AWS_ACCESS_KEY}
ENV AWS_SECRET_KEY=${AWS_SECRET_KEY}
ENV BUCKET_NAME=${BUCKET_NAME}
ENV VIDEO_BUCKET_NAME=${VIDEO_BUCKET_NAME}
ENV TASK_DEFINITION=${TASK_DEFINITION}
ENV CLUSTER=${CLUSTER}
ENV TRANSCODED_VIDEO_BUCKET_NAME=${TRANSCODED_VIDEO_BUCKET_NAME}

WORKDIR /app

COPY . /app

RUN go build -o main .

EXPOSE ${PORT}

CMD [ "./main" ]
